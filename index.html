<!doctype html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Photon Voxel Viewer</title>
	<script src="libs/three.js"></script>
	<script src="libs/OrbitControls.js"></script>
	<script src="libs/jszip.js"></script>
	<script src="libs/Pako.js"></script>
	<script src="libs/UPNG.js"></script>

	<script src="JS/FileHandling_cws.js"></script> <!-- zipped cws files -->
	<script src="JS/FileHandling_sl1.js"></script> <!-- zipped sl1 files -->
	<script src="JS/FileHandling_Photon.js"></script> <!-- .photon and .cbddlp files -->
	<script src="JS/FileHandling_Photons.js"></script> <!-- .photons files -->
	<script src="JS/FileHandling_pws.js"></script> <!-- .pws files -->

	<script src="JS/FileHandling_General.js"></script>

	<link rel="stylesheet" type="text/css" href="CSS/mainStyles.css"></link>
</head>

<body onresize="resizeCanvasToDisplaySize()">
	<div id="UI-overlay">
		<input type="file" id="files" name="files[]" accept=".photon,.photons,.cws,.zip" onchange="onFileSelected(event)"/>
		<output id="list"></output>
		<input id="layer-slider" type="range" min="0" max="100" value="0" style="width: 500px;">
		<div name="Glossary">
			<p> Move: RMB </p>
			<p> Zoom: scroll or MMB + drag </p>
			<p> Rotate: LMB </p>
			<p> Reset: F </p>
		</div>
		<div id="attribution">
			<p> Based on work by the <a href="http://photonsters.org">⭢ Photonsters community</a> and specifically by <a href="https://github.com/Rob2048/PhotonTool">⭢ Rob2084</a>. You dudes rock! </p>
			<p> This software is public domain, so do whatever you like with it. Source over at <a href="https://github.com/Ordenritterlein/PhotonTool">⭢ Github</a>.
			If you have issues, @me in the <a href="https://www.facebook.com/groups/AnycubicPhoton/">⭢ Facebook group</a>, name is Chris Graf. </p>
		</div>
	</div>

	<canvas id="thumb-small"></canvas>

	<div id="gl-view"></div>

	<!-- Load shaders ////////////////////////////////////////////////////////////// -->
	<script type="x-shader/x-vertex" id="vert_BaseShader" >
		varying vec3 pass_color;
		varying vec2 pass_uv;
		varying float pass_CamDist;
		void main() {
		  vec4 worldPos = modelMatrix * vec4( position, 1.0 );

		  vec3 viewDirection = cameraPosition - worldPos.xyz;

		  vec3 norm = normal;
		  norm.x = -norm.x;

		  vec3 cameraRight = normalize(vec4(1.0,0.0,0.0,0.0) * viewMatrix).rgb;
		  vec3 cameraUp = normalize(vec4(0.0,1.0,0.0,1.0) * viewMatrix).rgb;
		  vec3 cameraForward = (vec4(0.0,0.0,-1.0,0.0) * viewMatrix).rgb;

		  float r = dot(cameraRight, norm) * 0.5 + 0.5;
		  float g = dot(cameraUp, norm) * 0.5 + 0.5;
		  float b = dot(-cameraForward, norm) * 0.25 + 0.75;

		  pass_color = mix(vec3(0.0,0.0,0.0), vec3(r,g,b), sign(dot(viewDirection, norm)) * 0.5 + 0.5);
		  pass_uv = uv;
		  pass_CamDist = length(viewDirection);

		  gl_Position = projectionMatrix * viewMatrix * worldPos;
		}
	</script>
	<script type="x-shader/x-fragment" id="frag_BaseShader" >
		varying vec3 pass_color;
		varying vec2 pass_uv;
		varying float pass_CamDist;
		void main() {
		  float edges = max(abs(pass_uv.x),abs(pass_uv.y));
		  edges = edges *edges *edges * 0.15 * saturate(1.0-pass_CamDist);
		  gl_FragColor.rgb = pass_color - edges;
		  gl_FragColor.a = 1.0;
		}
	</script>
	<!-- /////////////////////////////////////////////////////////////////////////// -->

	<script src="JS/mainScript.js"></script>

</body>
</html>
